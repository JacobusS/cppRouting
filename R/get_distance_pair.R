#' Compute shortest distance between origin and destination nodes.
#' 
#' @param Graph  An object generated by cppRouting::makegraph() function.
#' @param from A vector of one or more vertices from which distances are calculated (origin).
#' @param to A vector of one or more vertices (destination).
#' @param algorithm character. "Dijkstra" or "A*"
#' @param constant numeric. Constant to maintain the heuristic function admissible. 
#' Default to 1, when cost is expressed in the same unit than coordinates. See details
#' @param allcores Logical. If TRUE, all cores are used.
#' @return Vector of shortest distances.
#' @note 'from' and 'to' must be the same length.
#' @details To perform A*, projected coordinates should be provided in the Graph object.  
#' To understand how A star algorithm work, see https://en.wikipedia.org/wiki/A*_search_algorithm .
#' To understand the importance of constant parameter, see the package description : https://github.com/vlarmet/cppRouting
#'
#' 
#'

get_distance_pair<-function(Graph,from,to,algorithm="Dijkstra",constant=1,allcores=FALSE){
  
  if (length(from)!=length(to)) stop("From and to have not the same length")
  
  if (any(is.na(cbind(from,to)))) stop("NAs are not allowed in origin/destination nodes")
  from<-as.character(from)
  to<-as.character(to)
  allnodes<-c(from,to)
  if (sum(allnodes %in% Graph$dict$ref)<length(allnodes)) stop("Some nodes are not in the graph")
  from_id<-Graph$dict$id[match(from,Graph$dict$ref)]
  to_id<-Graph$dict$id[match(to,Graph$dict$ref)]
  
  
  
  if (!is.null(Graph$coords)){
    if (algorithm=="A*"){
      message("Running A* ...")
      if (allcores==FALSE) res<-Astar(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode,Graph$coords[,2],Graph$coords[,3],constant)
      else res<-Astar_par(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode,Graph$coords[,2],Graph$coords[,3],constant)
    }
    else {
      message("Running Dijkstra ...")
      if (allcores==FALSE) res<-Dijkstra_early_stop(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode)
      else res<-Dijkstra_early_stop_par(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode)
    }
    
  }
  else {
    message("Running Dijkstra ...")
    if (allcores==FALSE) res<-Dijkstra_early_stop(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode)
    else res<-Dijkstra_early_stop_par(from_id,to_id,Graph$data$from,Graph$data$to,Graph$data$dist,Graph$nbnode)
  }
  
  #res<-data.frame(distance=res)
  #rownames(res)<-paste0(from,"_",to)
  return(res)
  
  
}
